{% extends 'base.twig' %}

{% block title %}Search | {{ parent() }}{% endblock %}

{% block sidebar %}

{% endblock %}

{% block content %}
  <div class="panel panel-default" id="search">
    <div class="panel-body">

      <h3>Search the Austin Papers</h3>

      <form action="search" class="form-horizontal" onsubmit="return queryChanged()" method="get">

        <div class="form-group">
          <div class="col-lg-12">
            <label for="query">Search:</label>
            <div class="input-group">
                <input type="text" class="form-control" id="query" name="query" placeholder="Search" value="{{ search_params.query }}">
              <span class="input-group-btn">
                <button type="submit" id="submit" class="btn btn-default">go</button>
              </span>
            </div><!-- input-group -->
          </div><!-- col-lg-12 -->
        </div><!-- form-group -->

        <div class="form-group">
          <div class="col-lg-6">
            <label for="fromPersonId">Author:</label>
            <select class="form-control" id="fromPersonId" name="fromPersonId">
              <option value="" {% if search_params.fromPersonId == '' %}selected{% endif %}>any...</option>
              <option value="7587">Stephen F. Austin</option>
              {% for id, author in search_dropdowns.fromPersonList %}
                <option value="{{ id }}" {% if search_params.fromPersonId == id %}selected{% endif %}>{{ author.person_name }} ({{ author.doc_frequency }} letters)</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-lg-6">
            <label for="toPersonId">Recipient:</label>
            <select class="form-control" id="toPersonId" name="toPersonId">
              <option value="" {% if search_params.toPersonId == '' %}selected{% endif %}>any...</option>
              <option value="7587">Stephen F. Austin</option>
              {% for id, recipient in search_dropdowns.toPersonList %}
                <option value="{{ id }}" {% if search_params.toPersonId == id %}selected{% endif %}>{{ recipient.person_name }} ({{ recipient.doc_frequency }} letters)</option>
              {% endfor %}
            </select>
          </div>
      </div><!-- form-group -->

        <div class="form-group">
          <div class="col-lg-6">
            <label for="fromYear">From year:</label>
            <select class="form-control" id="fromYear" name="fromYear">
              <option value="" {% if search_params.fromYear == '' %}selected{% endif %}>any...</option>
              {% for year, letters in search_dropdowns.yearList %}
                <option value="{{ year }}" {% if year == search_params.fromYear %}selected{% endif %}>{{ year }} ({{ letters }} letters)</option>
              {% endfor %}
            </select>
          </div><!-- col-lg-6 -->

          <div class="col-lg-6">
            <label for="toYear">To year:</label>
            <select class="form-control" id="toYear" name="toYear">
              <option value="" {% if search_params.toYear == '' %}selected{% endif %}>any...</option>
              {% for year, letters in search_dropdowns.yearList %}
                <option value="{{ year }}" {% if year == search_params.toYear %}selected{% endif %}>{{ year }} ({{ letters }} letters)</option>
              {% endfor %}
            </select>
          </div><!-- col-lg-6 -->
        </div><!-- form-group -->

        <div class="form-group">
          <div class="col-lg-6">
            <label for="fromPlaceId">Sent from:</label>
            <select class="form-control" id="fromPlaceId" name="fromPlaceId">
              <option value="" {% if search_params.fromPlaceId == '' %}selected{% endif %}>any...</option>
              {% for id, place in search_dropdowns.fromPlaceList %}
                <option value="{{ id }}" {% if search_params.fromPlaceId == id %}selected{% endif %}>{{ place.place_name }} ({{ place.doc_frequency }} letters)</option>
              {% endfor %}
            </select>
          </div><!-- col-lg-6 -->

          <div class="col-lg-6">
            <label for="toPlaceId">Sent to:</label>
            <select class="form-control" id="toPlaceId" name="toPlaceId">
              <option value="" {% if search_params.toPlaceId == '' %}selected{% endif %}>any...</option>
              {% for id, place in search_dropdowns.toPlaceList %}
                <option value="{{ id }}" {% if search_params.toPlaceId == id %}selected{% endif %}>{{ place.place_name }} ({{ place.doc_frequency }} letters)</option>
              {% endfor %}
            </select>
          </div><!-- col-lg-6 -->
        </div><!-- form-group -->

        <div class="form-group">
          <div class="col-lg-6">
            <label for="sentiment">Sentiment:</label>
            <select class="form-control" id="sentiment" name="sentiment">
              <option value="" {% if search_params.sentiment == '' %}selected{% endif %}>any...</option>
              {% for key, value in search_dropdowns.allSentiments %}
                <option value="{{ key }}" {% if key == search_params.sentiment %}selected{% endif %}>{{ value }}</option>
              {% endfor %}
            </select>
          </div><!-- col-lg-6 -->
        </div><!-- form-group -->

      </form>

      {% include 'results.twig' %}

      <script>
        var placeIdToNames = {{ search_dropdowns.placeIdToNames|raw }};
        var personIdToNames = {{ search_dropdowns.personIdToNames|raw }};
      </script>

    </div><!-- panel-body -->
  </div><!-- panel -->
{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="jqcloud/jqcloud.css">
{% endblock %}

{% block scripts_footer %}
  {{ parent() }}
  <script>
    var totalDocsCount = {{ totalDocsCount }};
    var totalDocDistribution = {{ totalDocDistribution|raw }};
  </script>
  <!-- Google AJAX API -->
  <script src="https://www.google.com/jsapi?key=AIzaSyCld462mkpAZrPllmHK8eJGXenW5Kus7g0"></script>
  <script src="assets/js/results.js"></script>
  <script src="jqcloud/jqcloud-1.0.0.js"></script>
  <script>
    $(function() {
      // Enable jQueryUI tabs
      $( "#tabs" ).tabs({
        beforeLoad: function( event, ui ) {
          ui.jqXHR.error(function() {
            ui.panel.html("This tab couldn't be loaded. Please try again later.");
          });
        }
      });
    });
  </script>
  {% if search_params != null %}
    <script>
      queryChanged();
    </script>
  {% endif %}
{% endblock %}