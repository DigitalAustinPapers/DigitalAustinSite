{"version":3,"sources":["results.js"],"names":["queryChanged","basicData","chartData","cityData","resultsListItems","requestData","$","removeClass","stringifyUrlQuery","getParams","encodeURIComponent","document","getElementById","value","sortKey","humanQueryString","console","log","history","pushState","window","path","ga","personId","personIdToNames","placeId","placeIdToNames","hide","show","innerHTML","getJSON","json","trigger","updateDocuments","$docList","$progressBar","$description","$sorter","$resultsSummary","resultsCount","length","text","addCommas","totalDocsCount","slideDown","addClass","delay","queue","this","dequeue","$paging","setNumber","setPage","prop","find","tooltip","container","placement","html","template","updateSentiment","tmp","minSentiment","Number","POSITIVE_INFINITY","maxSentiment","NEGATIVE_INFINITY","i","parseFloat","sentimentScore","each","$sentimentElement","$score","attr","negativeThreshold","positiveThreshold","updatePage","pageSlice","$listId","newPage","slice","empty","append","first","setupMap","mapOptions","center","google","maps","LatLng","zoom","mapTypeId","MapTypeId","TERRAIN","map","Map","getProjection","redrawAllCurves","event","addListener","redrawMarkers","cityClicked","markerIndex","infoWindows","close","open","markers","searchCity","id","direction","includes","replace","location","rgbToHtml","r","g","b","decColor","str","toString","drawCurve","startLatLng","endLatLng","curvyness","projection","p0","fromLatLngToPoint","p2","xDiff","x","yDiff","y","dist","Math","sqrt","pow","prevLatLng","currentLatLng","angle","atan2","PI","mid","Point","p1","cos","sin","SEGMENTS","t","fromPointToLatLng","floor","color","coords","line","Polyline","strokeColor","strokeOpacity","abs","strokeWeight","setMap","lines","push","doc","random","maxMarkers","getZoom","min","ceil","city","marker","Marker","position","title","onClickFunction","arguments","callee","contentHtml","parseInt","infowindow","InfoWindow","content","mapNeedsRerender","updateWordCharts","remove","wordChart","chartsNeedRerender","dataset","divId","dataSet","margin","top","right","bottom","left","d3","select","width","style","barHeight","barPadding","labelSpace","truncateLength","height","xScale","scale","linear","domain","max","d","weight","chart","ordinal","rangeBands","labelContainer","selectAll","data","enter","link","node","getBBox","range","barContainer","bars","parentNode","timelineData","resultsDomain","years","positive","neutral","negative","year","date","substring","undefined","minYear","maxYear","key","totalDocDistribution","intYear","yearStr","total","updateTimeChart","headers","shift","obj","rObj","mobile","rangeRoundBands","xAxis","svg","axis","orient","outerTickSize","innerTickSize","tickValues","yAxis","Year","filter","forEach","xy0","sentiment","name","xy1","call","on","href","toLowerCase","sentPercent","toFixed","isNaN","rangeBand","legend","reverse","timeChartNeedsUpdate","nStr","split","x1","x2","rgx","test","paging","pagingOpts","setOptions","onSelect","page","showPager","pages","e","alert","val","mapIsSetup","load","other_params","mapNeedRerender","display","css","timeChart","newTabId","target","hasClass"],"mappings":"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","file":"results.js","sourcesContent":["/*\n  Search results page javascript\n */\n\n// Global data\nvar basicData = null,\n    chartData = null,\n    cityData = null,\n    sortKey = 'date',\n    positiveThreshold = 2.0,\n    negativeThreshold = -2.0,\n    resultsListItems = null;\n// placeIdToNames and personIdToNames are declared in the search template\n\n/*  Changes the content to match the current query\n\n The content is immediately changed to a loading screen,\n then an asychronous data request is sent to the server.  When the data\n is received, the current view is reloaded.\n\n This function returns false so that it cancels the form submission\n */\nfunction queryChanged() {\n    // Invalidate all data that was for the old query parameters\n    basicData = null;\n    chartData = null;\n    cityData = null;\n    resultsListItems = null;\n\n    // Request data for the current view\n    requestData();\n\n    // reveal results div\n    $('.search-results').removeClass('hidden');\n\n    // Don't navigate away from this page\n    return false;\n}\n\n// Find form input selections on search screen and return search string for URI\nfunction stringifyUrlQuery() {\n    var getParams = '?query=';\n    getParams += encodeURIComponent(document.getElementById('query').value);\n    if (encodeURIComponent(document.getElementById('fromYear').value)) {\n        getParams += '&fromYear=';\n        getParams += encodeURIComponent(document.getElementById('fromYear').value);\n    }\n    if (encodeURIComponent(document.getElementById('toYear').value)) {\n        getParams += '&toYear=';\n        getParams += encodeURIComponent(document.getElementById('toYear').value);\n    }\n    if (encodeURIComponent(document.getElementById('fromPersonId').value)) {\n        getParams += '&fromPersonId=';\n        getParams += encodeURIComponent(document.getElementById('fromPersonId').value);\n    }\n    if (encodeURIComponent(document.getElementById('toPersonId').value)) {\n        getParams += '&toPersonId=';\n        getParams += encodeURIComponent(document.getElementById('toPersonId').value);\n    }\n    if (encodeURIComponent(document.getElementById('fromPlaceId').value)) {\n        getParams += '&fromPlaceId=';\n        getParams += encodeURIComponent(document.getElementById('fromPlaceId').value);\n    }\n    if (encodeURIComponent(document.getElementById('toPlaceId').value)) {\n        getParams += '&toPlaceId=';\n        getParams += encodeURIComponent(document.getElementById('toPlaceId').value);\n    }\n    if (encodeURIComponent(document.getElementById('sentiment').value)) {\n        getParams += '&sentiment=';\n        getParams += encodeURIComponent(document.getElementById('sentiment').value);\n    }\n    getParams += '&sort=';\n    getParams += encodeURIComponent(sortKey);\n\n    return getParams;\n}\n\n// Start data requests for the current view if necessary.\nfunction requestData() {\n    // Build the GET params\n    var getParams = stringifyUrlQuery(),\n        humanQueryString = \"\";\n\n    console.log(\"RequestData called\");\n\n    if (history.pushState) {\n        // Update browser URL\n        window.history.pushState({path:getParams},'', getParams);\n    }\n\n    // Google analytics event tracking\n    ga('send', 'event', 'search', 'submit', getParams);\n    ga('jasonTracker.send', 'event', 'search', 'submit', getParams);\n\n    // Create the search summary HTML\n    if(document.getElementById('query').value) {\n        humanQueryString = \"text: <b>\"+document.getElementById('query').value+\"</b>\";\n    }\n    if(document.getElementById('fromYear').value) {\n        humanQueryString += \" starting: <b>\"+document.getElementById('fromYear').value+\"</b>\";\n    }\n    if(document.getElementById('toYear').value) {\n        humanQueryString += \" ending: <b>\"+document.getElementById('toYear').value+\"</b>\";\n    }\n    if(document.getElementById('fromPersonId').value) {\n        var personId = document.getElementById('fromPersonId').value;\n        humanQueryString += \" sender: <b>\"+personIdToNames[personId]+\"</b>\";\n    }\n    if(document.getElementById('toPersonId').value) {\n        var personId = document.getElementById('toPersonId').value;\n        humanQueryString += \" recipient: <b>\"+personIdToNames[personId]+\"</b>\";\n    }\n    if(document.getElementById('fromPlaceId').value) {\n        var placeId = document.getElementById('fromPlaceId').value;\n        humanQueryString += \" sent from: <b>\"+placeIdToNames[placeId]+\"</b>\";\n    }\n    if(document.getElementById('toPlaceId').value) {\n        var placeId = document.getElementById('toPlaceId').value;\n        humanQueryString += \" sent to: <b>\"+placeIdToNames[placeId]+\"</b>\";\n    }\n    if(document.getElementById('sentiment').value) {\n        if(humanQueryString == \"\") {\n            $('#resultsFor').hide();\n        } else {\n            $('#resultsFor').show();\n        }\n        humanQueryString += \" with <b>\"+document.getElementById('sentiment').value+\"</b> sentiment scores\";\n    }\n    if(humanQueryString == \"\") {\n        humanQueryString = \"all results.\";\n    }\n\n    // Reveal results summary\n    document.getElementById('humanQuery').innerHTML = humanQueryString;\n\n    // Request new basic search data\n    $.getJSON('search_results.php' + getParams, function (json) {\n        $(document).trigger(\"basicDataLoaded\", [json]);\n    });\n\n    // Request new chart data only if it's being listened for\n    $.getJSON('data/cloud.php' + getParams, function (json) {\n        $(document).trigger(\"chartDataLoaded\", [json]);\n    });\n\n    // Request new city data only if it's being listened for\n    $.getJSON('data/cities.php' + getParams, function (json) {\n        $(document).trigger(\"cityDataLoaded\", [json]);\n    });\n\n    // Request new network\n    $.getJSON('data/network.php' + getParams, function (json) {\n        $(document).trigger(\"networkDataLoaded\", [json]);\n    });\n}\n\n/*\n  Document tab\n */\n\nvar $paging = $(\".pagination\").paging(0, pagingOpts);\n\n// Paging options are first declared in paging.js and overridden here\n$paging.setOptions({onSelect: function(page) {\n    updatePage(this.slice);\n    updateSentiment();\n    showPager(this.pages);\n}});\n\nfunction updateDocuments() {\n    var $docList = $('search-results-list'),\n        $progressBar = $('.documents-tab .searching-progress'),\n        $description = $('.documents-tab__description');\n        $sorter = $('.documents-tab .search-results__sort'),\n        $resultsSummary = $('.search-results__results-summary'),\n        resultsCount = basicData['json'].length;\n\n    // Remove existing sorter, results, and pager. show progress bar\n    $docList.hide();\n    $progressBar.show();\n    $sorter.hide();\n\n    // Fill in search summary\n    $('#resultsCount').text(addCommas(resultsCount));\n    $('#totalDocsCount').text(addCommas(totalDocsCount));\n    $resultsSummary.slideDown();\n\n    if(resultsCount === 1) {\n        document.getElementById('resultsPlural').innerHTML = \"result\";\n    }\n\n  // Apply alert class with CSS transition and remove after 2 seconds\n  $resultsSummary.addClass('search-results__results-summary--changed').delay(2000).queue(function() {\n          $(this).removeClass('search-results__results-summary--changed')\n          .dequeue();\n  });\n\n    // Set number of results in pager\n    $paging.setNumber(resultsCount).setPage();\n\n    $('#sort_' + sortKey).prop('checked',true);\n\n    $progressBar.hide();\n    $docList.show();\n    $sorter.show();\n    $description.show();\n\n    // Initialize bootstrap tooltip API for hover tooltips\n    $(function () {\n        $('.documents-tab').find('.fa-info-circle, .fa-question-circle').tooltip({\n            'container': 'body',\n            'placement': 'auto right',\n            'html': true,\n            'template': '<div class=\"tooltip\" role=\"tooltip\">' +\n            '<div class=\"tooltip-arrow\"></div>' +\n            '<div class=\"tooltip-inner\"></div>' +\n            '</div>'\n        })\n    });\n}\n\n$(document).on(\"basicDataLoaded\", function(e, data) {\n    // Invoked when new basic data is downloaded\n    if (data != null && data != basicData) {\n        basicData = data;\n        updateDocuments();\n    }\n    else alert(\"?\");\n});\n\n// Define behavior for when the sort options are clicked\n$('input:radio[name=sort]').on('click', function(e) {\n    sortKey = $('input:radio[name=sort]:checked').val();\n    queryChanged();\n});\n\n// Update class based on sentiment. Do that here instead of in template\n// because thresholds are defined in the javascript.\nfunction updateSentiment() {\n    var minSentiment = Number.POSITIVE_INFINITY,\n        maxSentiment = Number.NEGATIVE_INFINITY,\n        tmp;\n\n    for (var i=basicData.json.length-1; i>=0; i--) {\n        tmp = parseFloat(basicData.json[i].sentimentScore);\n        if (tmp < minSentiment) minSentiment = tmp;\n        if (tmp > maxSentiment) maxSentiment = tmp;\n    }\n\n    $('.search-results-list__item-sentiment').each(function() {\n        $(this).find('.search-result-list__item-sentiment-score--min').text(minSentiment);\n        $(this).find('.search-result-list__item-sentiment-score--max').text(maxSentiment);\n\n        var $sentimentElement = $(this),\n            $score = $sentimentElement.attr('data-sentiment');\n\n        if ($score < negativeThreshold) {\n            $sentimentElement.find('.search-result-list__item-sentiment-score')\n                .addClass('sentiment-negative')\n                .text('Negative');\n        } else if($score > positiveThreshold) {\n            $sentimentElement.find('.search-result-list__item-sentiment-score')\n                .addClass('sentiment-positive')\n                .text('Positive');\n        } else {\n            $sentimentElement.find('.search-result-list__item-sentiment-score')\n                .addClass('sentiment-neutral')\n                .text('Neutral');\n        }\n    });\n}\n\n/*\n * Document tab paging\n */\n\nfunction updatePage(pageSlice) {\n    /* Updates the current page when a page button is clicked\n     * @param {array} pageSlice This is an array with 2 values:\n     *     The start and end values to slice the page\n     */\n\n    var $listId = $('#documentsList'),\n        newPage = basicData['html'].slice(pageSlice[0], pageSlice[1]);\n\n    $listId.empty()\n        .append(newPage)\n        .first().attr('start', pageSlice[0]+1);\n}\n\n/*\n  Geographic tab\n */\n\nvar mapIsSetup = false,\n    map,\n    markers = [],\n    lines = [],\n    infoWindows = [];\n\n// Load Maps API package\ngoogle.load(\"maps\", \"3\", {other_params:'sensor=false'});\n\n// Performs initial map setup\nfunction setupMap() {\n    $('.geographic-chart-tab .searching-progress').show();\n    var mapOptions = {\n        center: new google.maps.LatLng(34, -94),\n        zoom: 4,\n        mapTypeId: google.maps.MapTypeId.TERRAIN\n    };\n    map = new google.maps.Map(document.getElementById(\"map\"), mapOptions);\n    if (map.getProjection() != null) {\n        redrawAllCurves();\n    }\n    else {\n        google.maps.event.addListener(map, 'projection_changed', redrawAllCurves);\n    }\n    redrawMarkers();\n    google.maps.event.addListener(map, 'zoom_changed', redrawMarkers);\n    $('.geographic-chart-tab .searching-progress').hide();\n    $('.geographic-chart-tab__description').show();\n}\n// Invoked when new city data is downloaded\n$(document).on(\"cityDataLoaded\", function(e, data) {\n    if (data != null && data != cityData) {\n        cityData = data;\n        mapNeedRerender = true;\n        if ($(\"#tab-geographic\")[0].style.display != \"none\") {\n            redrawAllCurves();\n            redrawMarkers();\n        }\n    }\n});\n\n//This function handles a click on a particular city within the Google Map\nfunction cityClicked(markerIndex)\n{\n    //Closes all info windows\n    for (var i=0; i<infoWindows.length; i++) {\n        infoWindows[i].close();\n    }\n\n    //Opens the info window for the selected marker\n    infoWindows[markerIndex].open(map, markers[markerIndex]);\n}\n\n// Changes the query's location filter to the given city\n// id must be a key in the NormalizedPlace table\n// direction must be string 'to' or 'from'\nfunction searchCity(id, direction) {\n\n    var getParams = stringifyUrlQuery();\n\n    if (direction === 'from') {\n        if (getParams.includes('&fromPlaceId')) {\n            getParams = getParams.replace(/fromPlaceId=[0-9]*/, 'fromPlaceId=' + id);\n        } else {\n            getParams += \"&fromPlaceId=\" + id;\n        }\n    } else if (direction === 'to') {\n        if (getParams.includes('&toPlaceId')) {\n            getParams = getParams.replace(/toPlaceId=[0-9]*/, 'toPlaceId=' + id);\n        } else {\n            getParams += \"&toPlaceId=\" + id;\n        }\n    }\n\n    window.location = \"search\" + getParams;\n}\n\n//Given an r, g, b, returns a string representing a color in html\n//Borrowed from the internet\nfunction rgbToHtml(r, g, b) {\n    var decColor = r + 256 * g + 65536 * b,\n        str = decColor.toString(16);\n\n    while (str.length < 6) {\n        str = '0' + str;\n    }\n    return \"#\" + str;\n}\n\n// Draws a Bezier curve on a Google Map\n//\n//  First, the start and end points are converted to screen coordinates.\n//  Then, the curvyness is used to generate a third point.  This point is\n//  equidistant from the endpoints and, if you were travelling from start\n//  to end, this point would be off to your left.  From these three points,\n//  we generate a Bezier curve.  Then this curve is coverted back into\n//  Lat/Long coordinates and plotted on the map.\n//  Each segment of this curve will transition from Red to Blue.\n//\n//@param map The Google Map on which to draw.\n//@param startLatLng The latitude/longitude of the curve's start point\n//@param endLatLng The latitude/longitude of the curve's end point\n//@param curvyness Determines how far the third point of the Bezier curve\n//  is from the straight line between the endpoints.\n//\n//Reference http://en.wikipedia.org/wiki/B%C3%A9zier_curve\nfunction drawCurve(map, startLatLng, endLatLng, curvyness) {\n    var projection = map.getProjection(),\n        p0 = projection.fromLatLngToPoint(startLatLng),\n        p2 = projection.fromLatLngToPoint(endLatLng),\n        xDiff = p2.x-p0.x,\n        yDiff = p2.y-p0.y,\n        dist = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\n\n    dist *= curvyness;\n\n    var angle = Math.atan2(yDiff, xDiff) + Math.PI/2,\n        mid = new google.maps.Point((p0.x+p2.x)/2, (p0.y+p2.y)/2),\n        p1 = new google.maps.Point(mid.x + dist * Math.cos(angle),\n            mid.y + dist*Math.sin(angle)),\n        SEGMENTS = 10,\n        prevLatLng,\n        currentLatLng,\n        first = true;\n\n    for (var i = 0; i <= SEGMENTS; i += 1) {\n        var t = i / SEGMENTS,\n            x = Math.pow(1 - t, 2) * p0.x + 2 * (1 - t) * t * p1.x\n                + Math.pow(t, 2) * p2.x,\n            y = Math.pow(1 - t, 2) * p0.y + 2 * (1 - t) * t * p1.y\n                + Math.pow(t, 2) * p2.y;\n\n        currentLatLng = projection.fromPointToLatLng(new google.maps.Point(x, y));\n\n        if (!first) {\n            var r = Math.floor(255*t);\n                color = rgbToHtml(r, 0, 255 - r),\n                coords = [prevLatLng, currentLatLng],\n                line = new google.maps.Polyline({\n                    path: coords,\n                    strokeColor: color,\n                    strokeOpacity: 0.1 + 0.4 * Math.abs(t - 0.5),\n                    strokeWeight: 5\n                });\n\n            line.setMap(map);\n            lines.push(line);\n        }\n        prevLatLng = currentLatLng;\n        first = false;\n    }\n}\n\nfunction redrawAllCurves() {\n    // Clear existing\n    for (var i=0; i<lines.length; i++) {\n        lines[i].setMap(null);\n    }\n\n    lines = [];\n\n    for (var i=0; i<basicData['json'].length; i++) {\n        doc = basicData['json'][i];\n        if (doc['srcLat'] != null && doc['dstLat'] != null) {\n            var curvyness = 0.1 + Math.random() * 0.2;\n            drawCurve(map,\n                new google.maps.LatLng(doc['srcLat'], doc['srcLng']),\n                new google.maps.LatLng(doc['dstLat'], doc['dstLng']),\n                curvyness);\n        }\n    }\n}\n\nfunction redrawMarkers() {\n    console.log(\"RedrawMarkers called.\");\n    if (cityData == null) {\n        console.log(\"Aborting.\");\n        console.log(cityData);\n        return;\n    }\n\n    //Clear all existing markers.\n    for (var i=0; i<markers.length; i++) {\n        markers[i].setMap(null);\n    }\n\n    markers = [];\n    infoWindows = [];\n\n    //Determine how many markers we want to draw at this zoom level\n    var maxMarkers;\n    if (map.getZoom() > 7) {\n        //If we are zoomed in really close, show them all\n        maxMarkers = cityData.length;\n    } else {\n        //Otherwise just show the first few (which are the ones with\n        //the most traffic)\n        maxMarkers = Math.min(cityData.length,\n            Math.ceil(Math.pow(map.getZoom(), 1.2)));\n    }\n\n    //Add the markers\n    for (i = 0; i < maxMarkers; i++) {\n        var city = cityData[i],\n            marker = new google.maps.Marker({\n                position: new google.maps.LatLng(city['lat'], city['lng']),\n                map: map,\n                title: city['name']\n            }),\n            onClickFunction = function() {\n            cityClicked(arguments.callee.markerIndex);\n        };\n\n        onClickFunction.markerIndex = i;\n        google.maps.event.addListener(marker, 'click', onClickFunction);\n        markers.push(marker);\n\n        var contentHtml = \"<span class='geography__city-name'>\" + city['name'] + \"</span><br />\"\n            + \"<b>\" + (parseInt(city['incoming']) + parseInt(city['outgoing'])) + \" Letters</b><br />\"\n            + \"<a class='geography__city-link' id='to-city-\" + city['id'] + \"' onClick='searchCity(\" + city['id'] + \", &apos;to&apos;)'>\" + city['incoming'] + \" Incoming Letters</a><br />\"\n            + \"<a class='geography__city-link' id='from-city-\" + city['id'] + \"' onClick='searchCity(\" + city['id'] + \", &apos;from&apos;)'>\" + city['outgoing'] + \" Outgoing Letters</a>\";\n\n        var infowindow = new google.maps.InfoWindow({\n            content: contentHtml\n        });\n        infoWindows.push(infowindow);\n    }\n    mapNeedsRerender = false;\n}\n\n/*\n  Chart tab\n */\n\nvar chartsNeedRerender = false;\nfunction updateWordCharts() {\n    $('.word-chart-tab .searching-progress').show();\n    $('.word-chart').removeClass(\"hidden\");\n    $('.word-chart__outer-svg').remove();\n\n    wordChart(chartData[2], \"#personChart\");\n    wordChart(chartData[1], \"#placeChart\");\n    wordChart(chartData[0], \"#wordChart\");\n\n    $('.word-chart-tab .searching-progress').hide();\n    $('.word-chart-tab__description').show();\n\n    chartsNeedRerender = false;\n}\n// Invoked when new chart data is downloaded\n$(document).on(\"chartDataLoaded\", function(e, data) {\n    if (data != null && data != chartData) {\n        chartData = data;\n        chartsNeedRerender = true;\n        if ($(\"#tab-charts\").css('display') != \"none\") {\n            updateWordCharts();\n        }\n    }\n});\n\nfunction wordChart(dataset, divId) {\n    // Chart defaults\n    var dataSet = dataset,\n        margin = {top: 0, right: 0, bottom: 0, left: 0},\n        container = d3.select(divId),\n        width = parseInt(container.style('width'))\n            - parseInt(container.style('padding-left'))\n            - parseInt(container.style('padding-right')),\n        width = width - margin.left - margin.right,\n        barHeight = 20,\n        barPadding = 5,\n        labelSpace = 150, // initial value\n        truncateLength = 20, // max label letters before truncation\n        height = (barHeight + barPadding) * dataSet.length\n            - margin.top - margin.bottom;\n\n    // Create the x scale\n    var xScale = d3.scale.linear()\n        .domain([0, d3.max(dataSet, function (d) {\n            return parseInt(d.weight, 10);\n        })]);\n\n    // Create the y scale\n    var yScale = d3.scale.ordinal()\n        .domain(dataSet.map(function (d) {\n            return d.text;\n        }))\n        .rangeBands([height, 0], .1);\n\n    // Create and append the outer svg and inner g for margins\n    var chart = d3.select(divId)\n        .append(\"svg\")\n        .attr(\"class\", \"word-chart__outer-svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"class\", \"word-chart__inner-g\")\n        .attr(\"width\", width)\n        .attr(\"transform\", \"translate(\" + [margin.left, margin.top] + \")\");\n\n    // Create and append the container for labels\n    var labelContainer = chart.append(\"g\")\n        .attr(\"class\", \"word-chart__label-container\")\n        .attr(\"width\", labelSpace);\n\n    // Add labels to the label container\n    labelContainer.selectAll(\"text\")\n        .data(dataSet)\n        .enter()\n        .append(\"a\")\n        .attr(\"class\", \"word-chart__label-link\")\n        .attr(\"xlink:href\", function(d) {\n            return d.link;\n        })\n        .attr(\"data-toggle\", function(d) {\n            if (d.text.length > truncateLength) {\n                return \"tooltip\";\n            }\n        })\n        .attr(\"data-placement\", function(d) {\n            if (d.text.length > truncateLength) {\n                return \"right\";\n            }\n        })\n        .attr(\"title\", function(d) {\n            return d.text;\n        })\n        .attr(\"data-ga-event\", function(d) {\n            return d.text;\n        })\n        .append(\"text\")\n        .attr(\"class\", \"word-chart__label-text\")\n        .attr(\"transform\", function (d, i) {\n            return \"translate(0,\" +\n                (i * (barHeight + barPadding) ) + \")\";\n        })\n        .attr(\"dy\", \"1em\")\n        .text(function (d) {\n            return d.text.length <= truncateLength ? d.text : d.text.slice(0, truncateLength) + '...';\n        });\n\n    // Update labelSpace to widest label\n    labelSpace = d3.select(divId).select(\".word-chart__label-container\").node().getBBox().width;\n\n    // Set x scale range after determining labelSpace\n    xScale.range([25, width - labelSpace]);\n\n    // Create and append a container for bars\n    var barContainer = chart.append(\"g\")\n        .attr(\"class\", \"word-chart__bar-container\");\n\n    // Create g elements for each bar and append inside bar container\n    var bars = barContainer.selectAll(\"g\")\n        .data(dataSet)\n        .enter()\n        .append(\"g\")\n        .attr(\"transform\", function (d, i) {\n            return \"translate(\" + labelSpace + \",\" +\n                (i * (barHeight + barPadding) ) + \")\";\n        });\n\n    // Adjust height of chart parent element\n    d3.select(chart.node().parentNode)\n        .style(\"height\", (height + margin.top + margin.bottom) + \"px\");\n\n    // Create and append the bars inside the bar container\n    bars.append(\"rect\")\n        .attr(\"class\", \"word-chart__bar\")\n        .attr(\"width\", function (d) {\n            return xScale(d.weight);\n        })\n        .attr(\"height\", barHeight - 1);\n\n    // Create and append the bar value labels inside the bar container\n    bars.append(\"text\")\n        .attr(\"class\", \"word-chart__item-weight\")\n        .attr(\"y\", barHeight / 2)\n        .attr(\"dy\", \".35em\")\n        .text(function (d) {\n            return addCommas(d.weight);\n        })\n        .attr(\"x\", function (d) {\n            return xScale(d.weight) - this.getBBox().width - 2;\n        });\n\n    // Initialize bootstrap tooltip API for hover tooltips\n    $(function () {\n        $('.word-chart-tab').find('[data-toggle=\"tooltip\"]').tooltip({\n            'container': 'body',\n            'html': true,\n            'template': '<div class=\"tooltip timechart__tooltip\" role=\"tooltip\">' +\n            '<div class=\"tooltip-arrow timechart__tooltip-arrow\"></div>' +\n            '<div class=\"tooltip-inner timechart__tooltip-inner\"></div>' +\n            '</div>'\n        })\n    });\n}\n\n/*\n  Timeline tab\n */\n\nvar timeChart;\nvar timeChartNeedsUpdate = true;\n\n// Convert basicData so it's usable by D3\nfunction timelineData(resultsDomain) {\n    if (basicData != null) {\n        var years = {},\n            positive = {},\n            neutral = {},\n            negative = {};\n\n        for (var i=0; i<basicData['json'].length; i++) {\n            var year = basicData['json'][i].date.substring(0, 4);\n\n            if (years[year] === undefined) {\n                years[year] = 1;\n            } else {\n                years[year]++;\n            }\n\n            if (positive[year] === undefined) {\n                positive[year] = 0;\n                neutral[year] = 0;\n                negative[year] = 0;\n            }\n\n            if (basicData['json'][i].sentimentScore < negativeThreshold) {\n                negative[year]++;\n            } else if (basicData['json'][i].sentimentScore > positiveThreshold) {\n                positive[year]++;\n            } else {\n                neutral[year]++;\n            }\n        }\n\n        var minYear = 2000,\n            maxYear = 1000;\n\n        for (var key in totalDocDistribution) {\n            // Find years with at least 15 documents\n            if (parseInt(totalDocDistribution[key]) >= 15) {\n                var intYear = parseInt(key);\n                if (intYear < minYear) {\n                    minYear = intYear;\n                }\n                if (parseInt(key) > maxYear) {\n                    maxYear = intYear;\n                }\n            }\n        }\n\n        var chartData = [['Year', 'Negative','Neutral','Positive']];\n\n        for (var i=minYear; i<=maxYear; i++) {\n            var yearStr = i.toString(),\n                value = 0;\n\n            if (years[yearStr] !== undefined) {\n                value = years[yearStr];\n            }\n            var total = 0;\n            if(resultsDomain) {\n                total = basicData['json'].length;\n            } else {\n                if (totalDocDistribution[yearStr] !== undefined) {\n                    total = parseInt(totalDocDistribution[yearStr]);\n                }\n            }\n\n            chartData.push([yearStr,\n                Math.floor(negative[yearStr] / total * 1000)/10,\n                Math.floor(neutral[yearStr] / total * 1000)/10,\n                Math.floor(positive[yearStr] / total * 1000)/10]);\n        }\n    }\n    return chartData;\n}\n\nfunction updateTimeChart(resultsDomain) {\n    /* Updates the timeline chart\n     * @param {bool} resultsDomain Whether to plot the chart using search results (true)\n     *                             or all documents (false)\n     */\n\n    $('.time-chart__outer-svg').attr('class', 'time-chart__outer-svg--hidden');\n    $('.time-chart-tab .searching-progress').show();\n\n    // Assign dataset from function call\n    var dataSet = timelineData(resultsDomain);\n    // Assign array of headers and remove from data\n    var headers = dataSet.shift();\n\n    // Map all years data to objects in data array\n    var data = dataSet.map(function(obj) {\n        var rObj = {};\n        rObj[headers[0]] = obj[0];\n        rObj[headers[1]] = obj[1];\n        rObj[headers[2]] = obj[2];\n        rObj[headers[3]] = obj[3];\n        return rObj;\n    });\n\n    // Determine if we're creating mobile version based on window width\n    var mobile = $(window).width() < 768;\n\n    // Set chart variables\n    var margin = {top: 60, right: 100, bottom: 100, left: 50},\n        container = d3.select('.time-chart'),\n        width = parseInt(container.style('width'))\n            - parseInt(container.style('padding-left'))\n            - parseInt(container.style('padding-right')),\n        height = mobile ? 750 : 500;\n\n    // mobile margin adjustments\n    if(mobile) {\n        margin.bottom = 125;\n        margin.right = 50;\n    }\n\n    // adjust for margins\n    width = width - margin.left - margin.right;\n    height = height - margin.top - margin.bottom;\n\n    // Set scales and ranges\n    if (mobile) {\n        var x = d3.scale.linear()\n            .range([0, width]);\n\n        var y = d3.scale.ordinal()\n            .rangeRoundBands([0, height], .1);\n    } else {\n        var x = d3.scale.ordinal()\n            .rangeRoundBands([0, width],.1);\n\n        var y = d3.scale.linear()\n            .range([height, 0]);\n    }\n\n    var color = d3.scale.ordinal()\n        .range([\"#d9534f\", \"#727272\", \"#5cb85c\"]);\n\n    // Set axes\n    if(mobile) {\n        var xAxis = d3.svg.axis()\n            .scale(x)\n            .orient(\"bottom\")\n            .outerTickSize(0)\n            .innerTickSize(-height + 5)\n            .tickValues([0, 25, 50, 75, 100]);\n\n        var yAxis = d3.svg.axis()\n            .scale(y)\n            .outerTickSize(0)\n            .orient(\"left\");\n\n    } else {\n        var xAxis = d3.svg.axis()\n            .scale(x)\n            .outerTickSize(0)\n            .orient(\"bottom\");\n\n        var yAxis = d3.svg.axis()\n            .scale(y)\n            .orient(\"left\")\n            .outerTickSize(0)\n            .innerTickSize(-width + 5)\n            .tickValues([0, 25, 50, 75, 100]);\n    }\n\n    // Create svg outer and inner elements\n    var svg = d3.select(\".time-chart\").append(\"svg\")\n        .attr(\"class\", \"time-chart__outer-svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"class\", \"time-chart__inner-g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    // Assign scale domains\n    if(mobile) {\n        x.domain([0, 100]);\n        y.domain(data.map(function(d) { return d.Year; }));\n    } else {\n        x.domain(data.map(function(d) { return d.Year; }));\n        y.domain([0, 100]);\n    }\n    color.domain(headers.filter(function(d) { return d !== \"Year\"; }));\n\n    // Bind colors and coordinates to each year/sentiment\n    data.forEach(function(d) {\n        var xy0 = 0;\n        d.sentiment = color.domain().map(function(name) {\n            return {\n                name: name,\n                year: d['Year'],\n                xy0: xy0,\n                xy1: xy0 += +d[name]\n            };\n        });\n        d.total = d.sentiment[d.sentiment.length -1].xy1;\n    });\n\n    if(mobile) {\n        // add x axis\n        svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis);\n\n        // add x axis label\n        svg.append(\"text\")\n            .attr(\"class\", \"x label\")\n            .attr(\"text-anchor\", \"middle\")\n            .attr(\"x\", width/2)\n            .attr(\"y\", height + margin.bottom - 90)\n            .attr(\"dy\", \".71em\")\n            .text(function() {\n                return resultsDomain ? \"% out of search results\" : \"% out of all documents\";\n            });\n\n        // add y axis labels with links to search\n        svg.append(\"g\")\n            .attr(\"class\", \"y axis\")\n            .call(yAxis)\n            .selectAll(\"text\")\n            .filter(function(d) { return typeof(d) == \"string\"; })\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", function(d) {\n                document.location.href = \"search?query=&fromYear=\"+ d + \"&toYear=\" + d;\n            });\n    } else {\n        // add x axis labels with links to search\n        svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis)\n            .selectAll(\"text\")\n            .filter(function(d) { return typeof(d) == \"string\"; })\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", function(d) {\n                document.location.href = \"search?query=&fromYear=\"+ d + \"&toYear=\" + d;\n            })\n            .style(\"text-anchor\", \"end\")\n            .attr(\"dx\", \"-.8em\")\n            .attr(\"dy\", \".15em\")\n            .attr(\"transform\", \"rotate(-65)\")\n            .attr(\"data-toggle\", \"tooltip\")\n            .attr(\"title\", function(d) {\n                return d + \"</br>\" + totalDocDistribution[d] + \" letters\";\n            });\n\n        // add x axis label\n        svg.append(\"text\")\n            .attr(\"class\", \"x label\")\n            .attr(\"text-anchor\", \"end\")\n            .attr(\"x\", width/2)\n            .attr(\"y\", height + margin.bottom - 30)\n            .attr(\"dy\", \".71em\")\n            .text(\"Year\");\n\n        // add y axis\n        svg.append(\"g\")\n            .attr(\"class\", \"y axis\")\n            .call(yAxis);\n\n        // add y axis label\n        svg.append(\"text\")\n            .attr(\"class\", \"y label\")\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr(\"y\", \"-50\")\n            .attr(\"x\", function() { return -height / 2; })\n            .attr(\"dy\", \".71em\")\n            .style(\"text-anchor\", \"middle\")\n            .text(function() {\n                return resultsDomain ? \"% out of search results\" : \"% out of all documents\";\n            });\n    }\n\n    // add scope title\n    svg.append(\"text\")\n        .attr(\"class\", \"time-chart__domain-title\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"x\", width/2)\n        .attr(\"y\", -50)\n        .attr(\"dy\", \".71em\")\n        .text(function() {\n            return resultsDomain ? \"Viewing search results distribution over time\" : \"Viewing percentage out of all documents\";\n        });\n\n    // add scope toggle\n    svg.append(\"text\")\n        .attr(\"class\", \"time-chart__domain-toggle\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"x\", width/2)\n        .attr(\"y\", -30)\n        .attr(\"dy\", \".71em\")\n        .text(function() {\n            return resultsDomain ? \"(See percentage out of all documents)\" : \"(See search results distribution over time)\" ;\n        })\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", function() {\n            return resultsDomain ? updateTimeChart(false) : updateTimeChart(true);\n        });\n\n    // add g element for each year's bars\n    var year = svg.selectAll(\".year\")\n        .data(data)\n        .enter().append(\"g\")\n        .attr(\"class\", function(d) { return \"time-chart__year \" + d.Year; })\n        .attr(\"transform\", function(d) {\n            if(mobile) {\n                return \"translate(0,\" + y(d.Year) + \")\";\n            } else {\n                return \"translate(\" + x(d.Year) + \",0)\";\n            }\n        });\n\n    // add rect elements with sentiment bars and links to new searches\n    year.selectAll(\"rect\")\n        .data(function(d) { return d.sentiment; })\n        .enter()\n        .append(\"a\")\n        .attr(\"class\", function(d) { return \"time-chart__bar--\" + d.name.toLowerCase(); })\n        .attr(\"id\", function(d) { return d.name.toLowerCase() + '-' + d.year; })\n        .attr(\"xlink:href\", function(d) {\n            return \"search?query=&fromYear=\"+ d.year + \"&toYear=\" + d.year + \"&sentiment=\" + d.name.toLowerCase();\n        })\n        .attr(\"data-toggle\", \"tooltip\")\n        .attr(\"title\", function(d) {\n            var sentPercent = parseFloat(d.xy1 - d.xy0).toFixed(1);\n            return d.year + \"</br>\" + d.name + \": \" + (sentPercent % 1 === 0 ? parseInt(sentPercent) : sentPercent);\n          })\n        .append(\"rect\")\n        .attr(\"class\", function(d) { return \"time-chart__bar--\" + d.name.toLowerCase(); })\n        .attr(\"width\", function(d) {\n            return mobile ? (isNaN(d.xy1) ? null : x(d.xy1) - x(d.xy0)) : x.rangeBand();\n        })\n        .attr(\"y\", function(d) {\n            return mobile ? null : (isNaN(d.xy1) ? null : y(d.xy1));\n        })\n        .attr(\"height\", function(d) {\n            return mobile ? y.rangeBand() : (isNaN(d.xy1) ? null : y(d.xy0) - y(d.xy1));\n             })\n        .attr(\"x\", function(d) {\n            return mobile ? (isNaN(d.xy0) ? null : x(d.xy0)) : null; })\n        .style(\"fill\", function(d) { return color(d.name); });\n\n    // create legend element\n    var legend = svg.selectAll(\".legend\")\n        .data(color.domain().slice().reverse())\n        .enter().append(\"a\")\n        .attr(\"xlink:href\", function(d) {\n            return \"search?query=&sentiment=\" + d.toLowerCase();\n        })\n        .append(\"g\")\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) {\n            return mobile ? \"translate(-50,\" + ((height + 60)+ i * 20) + \")\" : \"translate(0,\" + i * 20 + \")\";\n        });\n\n    // add legend colors\n    legend.append(\"rect\")\n        .attr(\"x\", width + 2)\n        .attr(\"width\", 18)\n        .attr(\"height\", 18)\n        .style(\"fill\", color);\n\n    // add legend text\n    legend.append(\"text\")\n        .attr(\"x\", width + 22)\n        .attr(\"y\", 9)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"start\")\n        .text(function(d) { return d; });\n\n    timeChartNeedsUpdate = false;\n\n    $('.time-chart-tab .searching-progress').hide();\n    $('.time-chart-tab__description').show();\n    $('.time-chart__outer-svg--hidden').remove();\n\n    // Initialize bootstrap tooltip API for hover tooltips\n    $(function () {\n        $('a[class^=time-chart__bar]').tooltip({\n            'container': 'body',\n            'placement': 'auto right',\n            'html': true,\n            'template': '<div class=\"tooltip timechart__tooltip\" role=\"tooltip\">' +\n                '<div class=\"tooltip-arrow timechart__tooltip-arrow\"></div>' +\n                '<div class=\"tooltip-inner timechart__tooltip-inner\"></div>' +\n                '</div>'\n        })\n    });\n\n    // Initialize bootstrap tooltip API for hover tooltips\n    $(function () {\n        $('.x.axis').find('text').tooltip({\n            'container': 'body',\n            'placement': 'auto top',\n            'html': true,\n            'template': '<div class=\"tooltip timechart__tooltip\" role=\"tooltip\">' +\n            '<div class=\"tooltip-arrow timechart__tooltip-arrow\"></div>' +\n            '<div class=\"tooltip-inner timechart__tooltip-inner\"></div>' +\n            '</div>'\n        })\n    })\n}\n\n// Invoked when new basic data is downloaded\n$(document).on(\"basicDataLoaded\", function(e, data) {\n    if (data != null) {\n        timeChartNeedsUpdate = true;\n        if ($(\"#tab-timeline\").css('display') != \"none\") {\n            updateTimeChart('results');\n        }\n    }\n});\n\n// A single event listener for tabs using bootstrap's tabs js\n$('a[data-toggle=\"tab\"]').on(\"shown.bs.tab\", function(e) {\n    newTabId = $(e.target).attr('href');\n    switch(newTabId) {\n        case '#tab-content':\n            break;\n        case '#tab-timeline':\n            if (timeChartNeedsUpdate) {\n                    updateTimeChart('results');\n            }\n            break;\n        case '#tab-geographic':\n            if (mapIsSetup !== true) {\n                setupMap();\n            } else if (mapNeedsRerender) {\n                redrawAllCurves();\n                redrawMarkers();\n            }\n            break;\n        case '#tab-charts':\n            if (chartsNeedRerender) {\n                updateWordCharts();\n            }\n            break;\n    }\n});\n\n// Add commas to number from http://www.mredkj.com/javascript/nfbasic.html\nfunction addCommas(nStr)\n{\n    nStr += '';\n    x = nStr.split('.');\n    x1 = x[0];\n    x2 = x.length > 1 ? '.' + x[1] : '';\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(x1)) {\n        x1 = x1.replace(rgx, '$1' + ',' + '$2');\n    }\n    return x1 + x2;\n}\n\n$('#tab-timeline').on('click', '.time-chart-tab__toggle-domain', function(e) {\n    timeChartNeedsUpdate = true;\n    if($(this).hasClass('time-chart-tab__toggle-domain--results')) {\n        $(this).addClass('time-chart-tab__toggle-domain--all')\n            .removeClass('time-chart-tab__toggle-domain--results')\n            .html('View percentage out of all documents');\n        updateTimeChart(true);\n    } else if($(this).hasClass('time-chart-tab__toggle-domain--all')) {\n        $(this).addClass('time-chart-tab__toggle-domain--results')\n            .removeClass('time-chart-tab__toggle-domain--all')\n            .html('View percentage out of search results');\n        updateTimeChart(false);\n    }\n});"],"sourceRoot":"/source/"}